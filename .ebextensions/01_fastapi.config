option_settings:
  aws:elasticbeanstalk:application:environment:
    PYTHONPATH: "/var/app/current/src:$PYTHONPATH"
  aws:elasticbeanstalk:environment:
    EnvironmentType: SingleInstance

container_commands:
  01_install_deps:
    command: |
      dnf install -y gcc gcc-c++ python3-devel libpq-devel
      
  02_install_requirements:
    command: |
      source /var/app/venv/*/bin/activate
      pip install --upgrade pip setuptools wheel
      pip install -r requirements.txt --no-cache-dir
      
  03_verify_install:
    command: |
      source /var/app/venv/*/bin/activate
      python -c "import fastapi; import uvicorn; print('FastAPI and Uvicorn installed successfully')"