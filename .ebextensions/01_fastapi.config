packages:
  yum:
    gcc: []
    gcc-c++: []
    python3-devel: []
    libpq-devel: []          # This provides pg_config

commands:
  01_update_yum:
    command: |
      yum update -y
      yum install -y amazon-linux-extras

option_settings:
  aws:elasticbeanstalk:application:environment:
    PYTHONPATH: "/var/app/current/src:$PYTHONPATH"
  aws:elasticbeanstalk:environment:
    EnvironmentType: SingleInstance

container_commands:
  01_upgrade_pip:
    command: |
      source /var/app/venv/*/bin/activate
      pip install --upgrade pip setuptools wheel

  02_install_requirements:
    command: |
      source /var/app/venv/*/bin/activate
      pip install -r requirements.txt --no-cache-dir

  03_verify_install:
    command: |
      source /var/app/venv/*/bin/activate
      python -c "import fastapi; import uvicorn; print('FastAPI and Uvicorn installed successfully')"